# 概念
## 什么是分库分表
当我们使用读写分离、索引、缓存后，数据库的压力还是很大的时候，这就需要使用到数据库拆分了。

分库：从单个数据库拆分成多个数据库的过程，将数据散落在多个数据库中。
分表：从单张表拆分成多张表的过程，将数据散落在多张表内。

## 为什么要分库分表
分库分表可以提升系统的稳定性跟负载能力，不存在单库/单表大数据。没有高并发的性能瓶颈，增加系统可用性。缺点是分库表无法join，只能通过接口方式解决，提高了系统复杂度。

## Sharding-JDBC 实现分库分表
Sharding-JDBC最早是当当网内部使用的一款分库分表框架，到2017年的时候才开始对外开源，这几年在大量社区贡献者的不断迭代下，功能也逐渐完善，现已更名为ShardingSphere， 2020年4月16日正式成为Apache软件基金会的顶级项目，同时兼容多种数据库，通过可插拔架构，理想情况下，可以做到对业务代码无感知。

# 使用手册

## 引入依赖
`<!-- sharding-jdbc -->
<dependency>
    <groupId>org.apache.shardingsphere</groupId>
    <artifactId>sharding-jdbc-spring-boot-starter</artifactId>
    <version>4.1.1</version>
</dependency>
`
## 配置分库分表规则
1：标准分片策略
2：复合分片策略
3：行表达式分片策略
4：Hint分片策略

本实例介绍了3：行表达式分片策略 和 1：标准分片策略

### 1：标准分片策略
见config配置目录

### 3：行表达式分片策略
见application.properties

## 问题
### 数据倾斜问题
行表达式分片算法、复合行表达式分片算法、Hint 行表达式分片算法的取模形式的行表达式算法也会存在这个问题。比方说，我们按5库20表进行发分库分表，只有分片键是0或是5的倍数才会落到0库，但是又因为是20表，所以落到0库的数据只会分布在0或5或10或15这4个表中，导致路由到0库的数据永远不会落到除上述4个表的其他16个表中

### 数据倾斜问题解决
个人是不太推荐单纯的根据分片键取模分片算法的，在实际的项目中一直使用的是自定义类分片算法，实质是根据分片键的最后一位数字对数据库数取模，分片键的倒数二三位数字对表数取模。这种方式可以尽量避免数据倾斜问题，不会存在某些库表永远不会有数据的情况。